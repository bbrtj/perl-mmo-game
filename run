#!/usr/bin/env perl

use v5.32;
use warnings;

use File::Basename;
use Env qw(@PATH @PERL5LIB);

my $dir = dirname(__FILE__);

# Carton
unshift @PATH, "$dir/local/bin";
unshift @PERL5LIB, "$dir/local/lib/perl5";

my ($arg) = @ARGV;
$arg //= '';

if ($arg eq 'lint') {
	system('tidyall -a --mode lint');
}
elsif ($arg =~ /^critic/) {
	system('tidyall -a --mode ' . $arg);
}
elsif ($arg eq 'prod') {
	system('hypnotoad script/web');
}
elsif ($arg eq 'dev') {
	my @watched = qw(lib templates);
	system("morbo script/web -w @watched");
}
else {
	system('script/worker &');
	system('script/server');
}
