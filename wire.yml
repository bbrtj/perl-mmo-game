env:
    class: Component::Env

db:
    class: Component::DB
    args:
        env:
            $ref: env

redis:
    class: Component::Redis
    args:
        env:
            $ref: env

log:
    class: Component::Log
    args:
        env:
            $ref: env
        filename: 'logs/application.log'

encoder:
    class: Component::Encoder

# Repositories

schema_repo:
    class: Repository::Schema
    args:
        db:
            $ref: db

cache:
    class: Repository::Cache
    args:
        redis:
            $ref: redis
        encoder:
            $ref: encoder

lore_data:
    class: Repository::LoreData
    args:
        db:
            $ref: db

units:
    class: Repository::Units
    args:
        db:
            $ref: db
        repo:
            $ref: schema_repo

# Services

user_service:
    class: Service::User
    args:
        repo:
            $ref: schema_repo

channel_service:
    class: Service::Channel
    args:
        store:
            $ref: redis
        encoder:
            $ref: encoder
        key: server_feedback

worker_channel_service:
    class: Service::Channel
    args:
        store:
            $ref: redis
        encoder:
            $ref: encoder
        key: server_jobs

# Others
worker:
    class: Server::Worker
    args:
        log:
            $ref: log
        channel:
            $ref: worker_channel_service
        cache:
            $ref: cache

server:
    class: Server
    args:
        log:
            $ref: log
        worker:
            $ref: worker
        channel:
            $ref: channel_service
        cache:
            $ref: cache

